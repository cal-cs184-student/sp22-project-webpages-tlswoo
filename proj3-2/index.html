<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">@import url('https://themes.googleusercontent.com/fonts/css?kit=ODelI1aHBYDBqgeIAH2zlJpCfVcp84aqLawScqpMaD_6HccaI_esRRCiUg1W99dz');ol{margin:0;padding:0}table td,table th{padding:0}.c7{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:16pt;font-family:"Source Sans Pro";font-style:normal}.c2{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:12pt;font-family:"Source Sans Pro";font-style:normal}.c3{color:#000000;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:12pt;font-family:"Source Sans Pro";font-style:normal}.c10{color:#000000;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:18pt;font-family:"Source Sans Pro";font-style:normal}.c8{color:#000000;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:26pt;font-family:"Source Sans Pro";font-style:normal}.c1{padding-top:0pt;padding-bottom:0pt;line-height:1.5;orphans:2;widows:2;text-align:center}.c11{padding-top:0pt;padding-bottom:3pt;line-height:1.0;orphans:2;widows:2;text-align:center}.c0{padding-top:0pt;padding-bottom:0pt;line-height:1.5;orphans:2;widows:2;text-align:left}.c5{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c6{page-break-after:avoid;height:18pt}.c4{height:12pt}.c9{page-break-after:avoid}.title{padding-top:0pt;color:#000000;font-weight:700;font-size:26pt;padding-bottom:3pt;font-family:"Source Sans Pro";line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:center}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:12pt;font-family:"Source Sans Pro"}p{margin:0;color:#000000;font-size:12pt;font-family:"Source Sans Pro"}h1{padding-top:0pt;color:#000000;font-weight:700;font-size:18pt;padding-bottom:0pt;font-family:"Source Sans Pro";line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Source Sans Pro";line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Source Sans Pro";line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Source Sans Pro";line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Source Sans Pro";line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Source Sans Pro";line-height:1.5;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c5"><p class="c9 c11 title" id="h.fyrjo2zbpnm3"><span class="c8">Pathtracer 3-2: Parts 1 &amp; 3</span></p><p class="c1"><span class="c7">Brandon Shin</span></p><p class="c1"><span class="c2">&lt;website link here&gt;</span></p><h1 class="c0 c6" id="h.ekgkkdfmf3j2"><span class="c3"></span></h1><h1 class="c0 c9" id="h.elhwiqdjannh"><span class="c3">NOTE: All provided images were compiled using the pre-compiled binaries.</span></h1><h1 class="c0 c9" id="h.566noj4zknyl"><span class="c10">Part 1: Mirror and Glass Materials</span></h1><p class="c0"><span class="c2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;First, I implemented the BSDF::reflect() function. Since we were dealing with object coordinates, where we reflect across the normal vector (0, 0, 1), this was just a matter of inverting the x and y coordinates of the input vector. Using this reflect function, I was able to implement MirrorBSDF::sample_f(), which is a delta BSDF. This means that we aren&rsquo;t actually drawing a random sample, and so we use our reflect function to get the reflection vector wi and set the pdf to 1. Using this reflection vector, we can scale and return the reflectance of the current BSDF correctly.</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Implementing refraction was much trickier than reflection. To start, I determined the value of eta, based on the z coordinate of the incoming vector wo. I then checked for total internal reflection, by checking if the expression </span><img src="images/image1.png"><span class="c2">&nbsp;is less than 0; if we do have total internal reflection, I just returned false. If not, we use the eta value calculated above, along with the square root of the total internal reflection expression, to come up with our refraction vector wi. Using this refraction vector, along with the quantity eta squared, we can scale down the transmittance of the current BSDF.</span></p><p class="c0"><span class="c2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Finally, to simulate a glass BSDF, I put together the two previous parts using the pseudocode in the project spec. In the case of total internal reflection, I avoided refraction and just reflected. Otherwise, I calculated the Schlick reflection constant, and using that, probabilistically determined whether this current ray would reflect, or refract. I then returned the corresponding value, scaled by the reflection constant (which also becomes the pdf in this case).</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Below are a set of renders taken of CBspheres.dae, with 64 samples per pixel and 4 samples per light, at varying maximum ray depths:</span><hr style="page-break-before:always;display:none;"></p><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 480.00px; height: 360.00px;"><img alt="" src="images/image12.png" style="width: 480.00px; height: 360.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c3">max_ray_depth = 0</span></p><p class="c0"><span class="c2">Since rays have zero bounces, only the light source itself can be seen (calculated in zero_bounce_radiance).</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0 c4"><span class="c2"></span></p><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 480.00px; height: 360.00px;"><img alt="" src="images/image9.png" style="width: 480.00px; height: 360.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c3">max_ray_depth = 1</span></p><p class="c0"><span class="c2">Rays are allowed one bounce, so we can now see the walls of the scene. As for the spheres, we can see the reflection of the ceiling light, since that is shown on the first bounce, but nothing further. The sphere on the left has a MirrorBSDF, so the light is completely reflected. The sphere on the right has a GlassBSDF, where the ceiling light isn&rsquo;t fully reflected. The gaps are created by the rays that are refracted based on Schick&rsquo;s reflection coefficient, which haven&rsquo;t had enough bounces to yield nonzero radiance values.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 480.00px; height: 360.00px;"><img alt="" src="images/image10.png" style="width: 480.00px; height: 360.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c3">max_ray_depth = 2</span></p><p class="c0"><span class="c2">The mirror sphere on the left is already reflecting the scene quite well, since the reflected rays have an additional bounce to return an actual radiance value from the scene. The reflections off of the glass sphere on the right are also visible, but all of our refractive rays have yet to either continue reflecting within the sphere, or refract through the other side of it, to yield a nonzero radiance value. The majority of the rays into the glass sphere seem to be refractive, than reflective, which will become apparent in the next image.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 480.00px; height: 360.00px;"><img alt="" src="images/image2.png" style="width: 480.00px; height: 360.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c3">max_ray_depth = 3</span></p><p class="c0"><span class="c2">Finally, the refraction rays have made it through on the rightmost sphere! The light from the ceiling light is also shining through the sphere, concentrated on the ground under it. The refraction rays have for the most part overpowered the reflection rays in the glass sphere, and we can finally see a relatively clear refracted image through it. On the mirrored sphere, we can see that the glass sphere still appears quite dark; this is because, again, we need one additional bounce for the rays that bounce off the mirror sphere to refract through the glass sphere.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 480.00px; height: 360.00px;"><img alt="" src="images/image5.png" style="width: 480.00px; height: 360.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c3">max_ray_depth = 4</span></p><p class="c0"><span class="c2">Continuing on my point from above, we can now see the glass sphere correctly reflected off of the mirrored sphere. The inside of the glass sphere has some additional noise, and is overall a degree brighter than before; the more internal bounces we have, the more chances for noise and higher-intensity rays to manifest. Note that there is also a slight bright spot on the rightmost blue wall; since the rays that produce this spot are converging at a particular spot, my guess is that either 1) rays from the ceiling light that bounce off the side of the mirror sphere converge through reflection there, or 2) the angle of the ceiling light and the glass sphere create a point of convergence for refraction rays there.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 480.00px; height: 360.00px;"><img alt="" src="images/image6.png" style="width: 480.00px; height: 360.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c3">max_ray_depth = 5</span></p><p class="c0"><span class="c2">This image doesn&rsquo;t have as many major developments between ray depths as the last few; there is more noise where the bottom of the glass sphere contacts the ground, and the light on the wall seems to have slightly changed shape.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 480.00px; height: 360.00px;"><img alt="" src="images/image13.png" style="width: 480.00px; height: 360.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c3">max_ray_depth = 100</span></p><p class="c0"><span>This image definitely has more noise than any of the previous ones: the reflection on the glass sphere of the ceiling light is much brighter and fuzzier, and the amount of bright pixels within the glass sphere has increased slightly. However, the light ray convergences seem to be more accurate; the light on the wall has taken a sharper and more definitive shape, and there is a clear distinction between the bottom of the glass sphere, and the bright spot under it, which to me looks more realistic.</span><hr style="page-break-before:always;display:none;"></p><h1 class="c0 c9" id="h.qesw1jsvdyzu"><span class="c10">Part 2: Environment Lighting</span></h1><p class="c0"><span class="c2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Environment lighting allows us to perform lighting simulation of a scene, where the light comes from the environment rather than/along with external lights. This allows for more natural and realistic lighting when dealing with scenes that take place in lit environments, like a house in a field, or a nighttime cafe with street lights shining through the windows. We use HDR environment maps in the form of .exr files to store environmental lighting data that &nbsp;we can access by changing between x-y coordinates and spherical coordinates. This allows us to store 360-degree data on lighting from a particular location.</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 312.00px;"><img alt="" src="images/image11.png" style="width: 624.00px; height: 312.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c2">Here is the probability_debug.png file for the grace.exr file, which I used for all my renders.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 312.00px;"><img alt="" src="images/image14.jpg" style="width: 624.00px; height: 312.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c2">&hellip; And here is grace.exr in .jpg format.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">Here is bunny_unlit.dae, rendered with both uniform and importance sampling with 4 samples per pixel, 64 samples per light.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 480.00px; height: 360.00px;"><img alt="" src="images/image7.png" style="width: 480.00px; height: 360.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c2">With uniform sampling, the lights in the scene are barely illuminating the bunny mesh, resulting in a very dark image. There are no clearly defined light spots shining on the bunny, but the image is almost noise-free without the additional lighting calculations.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 480.00px; height: 360.00px;"><img alt="" src="images/image4.png" style="width: 480.00px; height: 360.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c2">With importance sampling, the lighting and shadows are greatly improved, at the cost of additional noise. The lighting realism in this picture beats out the uniform sampling image by far, and increasing the number of samples per pixel greatly reduces the noise while keeping the very accurate lighting. Notice the multiple shadows under the bunny, which is a very realistic rendering considering there are several different light sources in this environment.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c0"><span class="c2">Here is the same comparison, this time with the dragon.dae mesh file.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 480.00px; height: 360.00px;"><img alt="" src="images/image3.png" style="width: 480.00px; height: 360.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c2">With uniform sampling, the dragon is much more well lit than the bunny; I believe this is because there are lights other than the environment lights in this scene, which make up for the weaker lighting achieved with uniform sampling. There is a fair amount of noise in the photo, and the environmental lights&rsquo; effects are overshadowed (ha!) by the included light.</span></p><p class="c0 c4"><span class="c2"></span></p><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 480.00px; height: 360.00px;"><img alt="" src="images/image8.png" style="width: 480.00px; height: 360.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span>With </span><span>importance</span><span>&nbsp;sampling, you can again see the multi-shadowing on the dragon&rsquo;s platform, from both the scene&rsquo;s light and the environment&rsquo;s lights. The image is quite bright since there are more lights adding their radiances onto each other, and the noise is about the same as in the uniformly sampled image. This image definitely looks more a part of this environment than the previous image.</span></p></body></html>